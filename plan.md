Implement the following plan:                                                                                                                                                                                  
                                                                                                                                                                                                                 
  # Publication Figure Redesign Plan                                                                                                                                                                             
                                                                                                                                                                                                                 
  ## Overview                                                                                                                                                                                                    
  Redesign the evaluation summary figures for publication with one information-dense main figure and several focused supporting figures using modern statistical visualization approaches.                       
                                                                                                                                                                                                                 
  ## Data Structure (from aggregated results)                                                                                                                                                                    
  **Key dimensions to visualize:**                                                                                                                                                                               
  - **Methods:** scvi, seurat                                                                                                                                                                                    
  - **Taxonomy levels (key):** subclass, class, family, global                                                                                                                                                   
  - **Cutoff:** 0, 0.05, 0.1, 0.15, 0.2, 0.25, 0.5, 0.75                                                                                                                                                         
  - **Reference:** multiple (whole_cortex, primary motor cortex, etc.)                                                                                                                                           
  - **Subsample_ref:** 50, 100, 500                                                                                                                                                                              
  - **Studies:** multiple per organism                                                                                                                                                                           
  - **Organisms:** mus_musculus, homo_sapiens                                                                                                                                                                    
  - **Metadata:** sex, treatment_state (mouse), disease_state (human), genotype, strain, age                                                                                                                     
                                                                                                                                                                                                                 
  **Available model outputs:**                                                                                                                                                                                   
  - `method_emmeans_summary.tsv` - marginal means with CI per method                                                                                                                                             
  - `method_cutoff_effects.tsv` - fitted F1 vs cutoff curves with CI                                                                                                                                             
  - `weighted_f1_results.tsv` - raw results per sample/condition                                                                                                                                                 
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ## Proposed Figure Set                                                                                                                                                                                         
                                                                                                                                                                                                                 
  ### Figure 1: Main Overview Panel (Information-Dense)                                                                                                                                                          
  **Purpose:** Single figure showing comprehensive benchmarking results at a glance                                                                                                                              
                                                                                                                                                                                                                 
  **Recommended Layout:** 2×2 panel (A-D)                                                                                                                                                                        
                                                                                                                                                                                                                 
  ```                                                                                                                                                                                                            
  ┌─────────────────────┬─────────────────────┐                                                                                                                                                                  
  │  A: Cutoff curves   │  B: Method effect   │                                                                                                                                                                  
  │  (F1 vs cutoff      │  (Forest plot from  │                                                                                                                                                                  
  │   by method)        │   emmeans)          │                                                                                                                                                                  
  ├─────────────────────┼─────────────────────┤                                                                                                                                                                  
  │  C: Taxonomy level  │  D: Cross-study     │                                                                                                                                                                  
  │  (Slope chart:      │  (Strip/swarm plot  │                                                                                                                                                                  
  │   subclass→global)  │   by study)         │                                                                                                                                                                  
  └─────────────────────┴─────────────────────┘                                                                                                                                                                  
  ```                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  **Panel details:**                                                                                                                                                                                             
  - **A:** Use `method_cutoff_effects.tsv` - line plot with CI ribbon, colored by method                                                                                                                         
  - **B:** Use `method_emmeans_summary.tsv` - horizontal forest plot showing scvi vs seurat with 95% CI                                                                                                          
  - **C:** Slope/bump chart connecting method performance across subclass→class→family→global                                                                                                                    
  - **D:** Swarm plot of weighted_f1 by study, colored by method, showing generalization                                                                                                                         
                                                                                                                                                                                                                 
  **Implementation:** New `bin/plot_main_figure.py`                                                                                                                                                              
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ### Figure 2: Method Comparison Forest Plot (Modern Statistical)                                                                                                                                               
  **Purpose:** Detailed statistical comparison with effect sizes                                                                                                                                                 
                                                                                                                                                                                                                 
  **Visualization:** Multi-row forest plot showing:                                                                                                                                                              
  - Row per factor (method, reference, subsample_ref, treatment/disease)                                                                                                                                         
  - Point estimate + 95% CI from emmeans                                                                                                                                                                         
  - Vertical reference line at grand mean                                                                                                                                                                        
  - Faceted by taxonomy level (subclass | class | family | global)                                                                                                                                               
                                                                                                                                                                                                                 
  **Data source:** `*_emmeans_summary.tsv` files                                                                                                                                                                 
                                                                                                                                                                                                                 
  **Implementation:** New `bin/plot_forest.py` or refactor `plot_contrasts.py`                                                                                                                                   
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ### Figure 3: Parameter Sensitivity (Minimal/Clean)                                                                                                                                                            
  **Purpose:** Show how cutoff threshold affects performance                                                                                                                                                     
                                                                                                                                                                                                                 
  **Visualization:**                                                                                                                                                                                             
  - Single clean line plot with CI ribbon                                                                                                                                                                        
  - X: cutoff (0 → 0.75)                                                                                                                                                                                         
  - Y: Estimated F1 score                                                                                                                                                                                        
  - Color: method (scvi blue, seurat orange)                                                                                                                                                                     
  - **Key insight to highlight:** scvi degrades faster at high cutoffs                                                                                                                                           
                                                                                                                                                                                                                 
  **Data source:** `method_cutoff_effects.tsv`                                                                                                                                                                   
                                                                                                                                                                                                                 
  **Implementation:** Refactor `bin/plot_continuous_contrasts.py`                                                                                                                                                
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ### Figure 4: Cross-Study Generalization (Modern Statistical)                                                                                                                                                  
  **Purpose:** Show variability across studies/datasets                                                                                                                                                          
                                                                                                                                                                                                                 
  **Visualization options (pick one):**                                                                                                                                                                          
                                                                                                                                                                                                                 
  **Option A: Raincloud plots**                                                                                                                                                                                  
  - Half-violin (distribution) + jittered points + box                                                                                                                                                           
  - Y: Study name (sorted by median F1)                                                                                                                                                                          
  - X: Weighted F1 score                                                                                                                                                                                         
  - Color: Method                                                                                                                                                                                                
                                                                                                                                                                                                                 
  **Option B: Caterpillar/forest plot by study**                                                                                                                                                                 
  - Point + CI per study                                                                                                                                                                                         
  - Sorted by effect size                                                                                                                                                                                        
  - Shows which studies are hardest                                                                                                                                                                              
                                                                                                                                                                                                                 
  **Implementation:** New `bin/plot_generalization.py`                                                                                                                                                           
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ### Figure 5: Taxonomy Hierarchy Effect (Minimal)                                                                                                                                                              
  **Purpose:** Show that coarser classifications (family, global) are easier                                                                                                                                     
                                                                                                                                                                                                                 
  **Visualization:** Connected dot plot / slope chart:                                                                                                                                                           
  - X: Taxonomy level (subclass → class → family → global)                                                                                                                                                       
  - Y: Mean weighted F1                                                                                                                                                                                          
  - Lines connect same method across levels                                                                                                                                                                      
  - Shows expected increase in F1 at coarser levels                                                                                                                                                              
                                                                                                                                                                                                                 
  **Implementation:** Can be Panel C of Figure 1 or standalone                                                                                                                                                   
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ### Supplementary Figures                                                                                                                                                                                      
                                                                                                                                                                                                                 
  **S1: Computational Performance**                                                                                                                                                                              
  - Horizontal bar chart: mean runtime by process                                                                                                                                                                
  - Include memory usage as secondary axis or separate panel                                                                                                                                                     
  - Cleaner than current violin plots                                                                                                                                                                            
                                                                                                                                                                                                                 
  **S2: Metadata Effects (Organism-Specific)**                                                                                                                                                                   
  - Forest plots for mouse: treatment_state, sex, genotype                                                                                                                                                       
  - Forest plots for human: disease_state, sex, dev_stage                                                                                                                                                        
                                                                                                                                                                                                                 
  **S3: Reference Atlas Comparison**                                                                                                                                                                             
  - Heatmap or grouped bar showing F1 by reference × method                                                                                                                                                      
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ## Implementation Strategy                                                                                                                                                                                     
                                                                                                                                                                                                                 
  ### Phase 1: Create shared utilities                                                                                                                                                                           
  Create `bin/plot_utils.py`:                                                                                                                                                                                    
  ```python                                                                                                                                                                                                      
  # Color palettes                                                                                                                                                                                               
  METHOD_COLORS = {'scvi': '#1f77b4', 'seurat': '#ff7f0e'}                                                                                                                                                       
  KEY_ORDER = ['subclass', 'class', 'family', 'global']                                                                                                                                                          
                                                                                                                                                                                                                 
  # Publication theme                                                                                                                                                                                            
  def set_pub_style():                                                                                                                                                                                           
  plt.rcParams.update({                                                                                                                                                                                          
  'font.family': 'Arial',                                                                                                                                                                                        
  'font.size': 10,                                                                                                                                                                                               
  'axes.linewidth': 0.8,                                                                                                                                                                                         
  'axes.spines.top': False,                                                                                                                                                                                      
  'axes.spines.right': False,                                                                                                                                                                                    
  })                                                                                                                                                                                                             
                                                                                                                                                                                                                 
  # Helper functions                                                                                                                                                                                             
  def forest_plot(ax, data, x_col, y_col, ci_cols, ...)                                                                                                                                                          
  def raincloud_plot(ax, data, x_col, y_col, hue_col, ...)                                                                                                                                                       
  def slope_chart(ax, data, x_levels, y_col, group_col, ...)                                                                                                                                                     
  ```                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ### Phase 2: Main figure script                                                                                                                                                                                
  Create `bin/plot_main_figure.py`:                                                                                                                                                                              
  - Reads emmeans and cutoff_effects files                                                                                                                                                                       
  - Creates 2×2 subplot figure                                                                                                                                                                                   
  - Exports as PDF (vector) and PNG (300 DPI)                                                                                                                                                                    
                                                                                                                                                                                                                 
  ### Phase 3: Refactor existing scripts                                                                                                                                                                         
  - `plot_continuous_contrasts.py` → cleaner styling, use plot_utils                                                                                                                                             
  - `plot_contrasts.py` → replace manual brackets with forest plot approach                                                                                                                                      
  - `plot_comptime.py` → bar chart instead of violin                                                                                                                                                             
                                                                                                                                                                                                                 
  ### Phase 4: Nextflow integration                                                                                                                                                                              
  - Add module for main figure if needed                                                                                                                                                                         
  - Update workflow to call new scripts                                                                                                                                                                          
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ## Files to Create/Modify                                                                                                                                                                                      
                                                                                                                                                                                                                 
  | File | Action | Priority |                                                                                                                                                                                   
  |------|--------|----------|                                                                                                                                                                                   
  | `bin/plot_utils.py` | CREATE | High |                                                                                                                                                                        
  | `bin/plot_main_figure.py` | CREATE | High |                                                                                                                                                                  
  | `bin/plot_forest.py` | CREATE | Medium |                                                                                                                                                                     
  | `bin/plot_generalization.py` | CREATE | Medium |                                                                                                                                                             
  | `bin/plot_continuous_contrasts.py` | REFACTOR | Medium |                                                                                                                                                     
  | `bin/plot_contrasts.py` | REFACTOR | Low (replace with forest) |                                                                                                                                             
  | `bin/plot_comptime.py` | REFACTOR | Low |                                                                                                                                                                    
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ## Visual Style Guide                                                                                                                                                                                          
                                                                                                                                                                                                                 
  **Colors:**                                                                                                                                                                                                    
  - scvi: `#1f77b4` (blue)                                                                                                                                                                                       
  - seurat: `#ff7f0e` (orange)                                                                                                                                                                                   
  - Colorblind-safe palette backup: use `seaborn.color_palette("colorblind")`                                                                                                                                    
                                                                                                                                                                                                                 
  **Typography:**                                                                                                                                                                                                
  - Font: Arial or Helvetica (sans-serif)                                                                                                                                                                        
  - Axis labels: 10pt                                                                                                                                                                                            
  - Titles: 11pt bold                                                                                                                                                                                            
  - Tick labels: 9pt                                                                                                                                                                                             
                                                                                                                                                                                                                 
  **Figure specs:**                                                                                                                                                                                              
  - Main figure: 180mm wide (full page), ~150mm tall                                                                                                                                                             
  - Single-column: 85mm wide                                                                                                                                                                                     
  - DPI: 300 for PNG, vector preferred (PDF/SVG)                                                                                                                                                                 
  - Line width: 1.5pt for data, 0.8pt for axes                                                                                                                                                                   
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ## Verification Plan                                                                                                                                                                                           
                                                                                                                                                                                                                 
  1. Generate test figures with current aggregated data                                                                                                                                                          
  2. Check figure dimensions against target journal specs                                                                                                                                                        
  3. Verify CI bands match emmeans output exactly                                                                                                                                                                
  4. Test colorblind accessibility with simulator                                                                                                                                                                
  5. Export both PDF (vector) and PNG (raster)                                                                                                                                                                   
  6. Review with co-authors before final integration                                                                                                                                                             
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
                                                                                                                                                                                                                 
  ## Summary                                                                                                                                                                                                     
                                                                                                                                                                                                                 
  **Main figure (1):** Information-dense 2×2 panel showing cutoff sensitivity, method comparison, taxonomy effect, and cross-study variability                                                                   
                                                                                                                                                                                                                 
  **Supporting figures (2-4):** Focused single-concept figures using forest plots and rainclouds                                                                                                                 
                                                                                                                                                                                                                 
  **Supplementary:** Computational performance, metadata effects, reference comparisons                                                                                                                          
                                                                                                                                                                                                                 
                             